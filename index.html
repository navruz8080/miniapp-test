<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Drop SuperApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #F2F3F5; --card: #FFFFFF; --text: #1F1F1F; --sec: #8E8E93; --blue: #007AFF; --green: #34C759; --radius: 18px; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .container { padding: 16px; max-width: 480px; margin: 0 auto; padding-bottom: 100px; }
        .screen { display: none; width: 100%; animation: fadeIn 0.2s ease; }
        .screen.active { display: block !important; }
        @keyframes fadeIn { from {opacity:0} to {opacity:1} }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-top: 10px; }
        .user-row { display: flex; align-items: center; gap: 10px; cursor: pointer; } /* –î–æ–±–∞–≤–∏–ª–∏ –∫—É—Ä—Å–æ—Ä */
        .ava { width: 44px; height: 44px; border-radius: 50%; background: #eee; object-fit: cover; }
        .lvl-badge { background: #FFD60A; color: #000; font-size: 10px; padding: 2px 6px; border-radius: 8px; font-weight: 800; text-transform: uppercase; }
        
        .bonus-card { background: linear-gradient(135deg, #111 0%, #333 100%); border-radius: 22px; padding: 20px; color: white; margin-bottom: 24px; box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        .b-val { font-size: 32px; font-weight: 800; margin: 5px 0; }
        .b-btn { background: rgba(255,255,255,0.2); border: none; color: #fff; padding: 8px 14px; border-radius: 10px; font-size: 12px; font-weight: 600; cursor: pointer; }
        
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 25px; }
        .grid-item { display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer; transition: transform 0.1s; }
        .grid-item:active { transform: scale(0.9); }
        .icon-box { width: 60px; height: 60px; background: var(--card); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.04); }
        .grid-lbl { font-size: 11px; font-weight: 600; color: var(--text); text-align: center; line-height: 1.2; }
        
        .card { background: var(--card); padding: 16px; border-radius: var(--radius); margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.02); box-sizing: border-box; }
        
        .pkg-item { display: flex; justify-content: space-between; align-items: center; padding: 14px 0; border-bottom: 1px solid #f2f2f2; gap: 10px; }
        .pkg-item:last-child { border-bottom: none; }
        .pkg-info { flex: 1; min-width: 0; }
        .pkg-name { font-weight: 700; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .pkg-sub { font-size: 12px; color: var(--sec); margin-top: 2px; }
        .pkg-status { font-size: 10px; font-weight: 800; padding: 5px 10px; border-radius: 10px; background: #eee; color: #666; text-transform: uppercase; text-align: center; min-width: 90px; }
        .status-ready { background: #E8F5E9; color: #2E7D32; }
        
        .nav-head { background: #fff; position: sticky; top: 0; z-index: 99; padding: 12px 16px; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid #eee; }
        .pg-title { font-size: 18px; font-weight: 800; }
        .btn { width: 100%; padding: 16px; border-radius: 16px; border: none; background: var(--text); color: #fff; font-weight: 700; font-size: 16px; cursor: pointer; }
        .btn-blue { background: var(--blue); }
        input, select { width: 100%; padding: 14px; background: #F2F4F7; border: none; border-radius: 12px; margin-bottom: 12px; font-size: 15px; box-sizing: border-box; font-family: inherit; }
        
        .copy-box { background: #F8F9FB; padding: 14px; border-radius: 14px; border: 1px dashed #d1d1d1; position: relative; cursor: pointer; }
        .switch-row { display: flex; justify-content: space-between; align-items: center; }
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; border-radius: 34px; transition: .2s; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 2px; bottom: 2px; background-color: white; border-radius: 50%; transition: .2s; }
        input:checked + .slider { background-color: var(--blue); }
        input:checked + .slider:before { transform: translateX(20px); }

        .tabs { background: #E5E5EA; padding: 4px; border-radius: 12px; display: flex; margin-bottom: 15px; }
        .tab { flex: 1; padding: 8px; text-align: center; font-size: 13px; font-weight: 600; border-radius: 9px; cursor: pointer; color: #8E8E93; }
        .tab.active { background: #fff; color: #000; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        .modal-wrap { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; display: none; align-items: flex-end; }
        .modal { background: #fff; width: 100%; border-radius: 24px 24px 0 0; padding: 24px; box-sizing: border-box; }
        
        .info-list { list-style: none; padding: 0; margin: 0; }
        .info-list li { padding: 12px 0; border-bottom: 1px solid #f2f2f2; display: flex; align-items: center; gap: 10px; font-size: 14px; }
        .info-list li:last-child { border-bottom: none; }
        .rate-row { display: flex; justify-content: space-between; padding: 8px 0; }
    </style>
</head>
<body>

    <div id="screen-home" class="screen active">
        <div class="container">
            <div class="header">
                <div class="user-row" onclick="nav('profile')">
                    <img id="u-ava" class="ava" src="">
                    <div>
                        <div style="display:flex; align-items:center; gap:6px;">
                            <b id="u-name">...</b>
                            <span id="u-lvl" class="lvl-badge">...</span>
                        </div>
                        <div style="font-size:12px; color:var(--sec);">–ü—Ä–æ—Ñ–∏–ª—å <i class="fa-solid fa-chevron-right" style="font-size:8px;"></i></div>
                    </div>
                </div>
                <div onclick="nav('settings')" style="padding:10px;"><i class="fa-solid fa-gear"></i></div>
            </div>

            <div class="bonus-card">
                <div style="opacity:0.7; font-size:12px;">–ë–æ–Ω—É—Å–Ω—ã–π –±–∞–ª–∞–Ω—Å</div>
                <div class="b-val"><span id="u-bonus">0</span> <span style="font-size:16px;">–∫–≥</span></div>
                <button class="b-btn" onclick="nav('rewards')"><i class="fa-solid fa-star"></i> –ó–∞–¥–∞–Ω–∏—è</button>
            </div>

            <div class="grid">
                <div class="grid-item" onclick="nav('china')"><div class="icon-box" style="color: #FF2D55;"><i class="fa-brands fa-dhl"></i></div><span class="grid-lbl">–ú–æ–π –ö–∏—Ç–∞–π</span></div>
                <div class="grid-item" onclick="nav('trucks')"><div class="icon-box" style="color: #5856D6;"><i class="fa-solid fa-truck-fast"></i></div><span class="grid-lbl">–ë–∏—Ä–∂–∞</span></div>
                <div class="grid-item" onclick="nav('market')"><div class="icon-box" style="color: #FF9500;"><i class="fa-solid fa-bag-shopping"></i></div><span class="grid-lbl">–ú–∞—Ä–∫–µ—Ç</span></div>
                <div class="grid-item" onclick="nav('calc')"><div class="icon-box" style="color: #007AFF;"><i class="fa-solid fa-calculator"></i></div><span class="grid-lbl">–†–∞—Å—á–µ—Ç</span></div>
            </div>

            <div class="card" style="background: #E3F2FD; display:flex; align-items:center; gap:15px; padding:20px;" onclick="nav('rewards')">
                <i class="fa-solid fa-gift" style="font-size:24px; color:var(--blue);"></i>
                <div><b>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</b><div style="font-size:12px;">–î–∞—Ä–∏–º –±–æ–Ω—É—Å—ã –∑–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞</div></div>
            </div>
        </div>
    </div>

    <div id="screen-profile" class="screen">
        <div class="nav-head"><div onclick="goHome()"><i class="fa-solid fa-arrow-left"></i></div><div class="pg-title">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</div></div>
        <div class="container">
            <div class="card" style="text-align: center; padding: 30px 20px;">
                <div style="position: relative; display: inline-block;">
                    <img id="p-ava" src="" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 4px solid #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <div id="p-lvl-tag" class="lvl-badge" style="position: absolute; bottom: 0; right: 0; padding: 4px 10px; font-size: 12px; border: 2px solid #fff;">...</div>
                </div>
                <h2 id="p-name" style="margin: 15px 0 5px 0;">...</h2>
                <div style="font-size:12px; color:var(--sec);">ID: <span id="p-id">...</span></div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                <div class="card" style="margin-bottom: 0; text-align: center;">
                    <div style="font-size: 12px; color: var(--sec);">–ë–æ–Ω—É—Å—ã</div>
                    <div style="font-size: 20px; font-weight: 800; color: var(--green);"><span id="p-bonus">0</span> –∫–≥</div>
                </div>
                <div class="card" style="margin-bottom: 0; text-align: center;">
                    <div style="font-size: 12px; color: var(--sec);">–°—Ç–∞—Ç—É—Å</div>
                    <div style="font-size: 14px; font-weight: 700;" id="p-status-name">...</div>
                </div>
            </div>
            <div class="card" style="padding: 0;">
                <div class="pkg-item" style="padding: 16px;" onclick="nav('settings')">
                    <div style="display:flex; align-items:center; gap:12px;"><i class="fa-solid fa-user-pen" style="color:var(--blue);"></i><b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∞–Ω–Ω—ã—Ö</b></div>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-china" class="screen">
        <div class="nav-head"><div onclick="goHome()"><i class="fa-solid fa-arrow-left"></i></div><div class="pg-title">–ú–æ–π –ö–∏—Ç–∞–π</div></div>
        <div class="container">
            <div class="grid" style="grid-template-columns: repeat(3, 1fr); gap: 15px;">
                <div class="grid-item" onclick="nav('packages')"><div class="icon-box" style="color: #FF2D55;"><i class="fa-solid fa-box-open"></i></div><span class="grid-lbl">–ü–æ—Å—ã–ª–∫–∏</span></div>
                <div class="grid-item" onclick="nav('addresses')"><div class="icon-box" style="color: #34C759;"><i class="fa-solid fa-map-location-dot"></i></div><span class="grid-lbl">–ê–¥—Ä–µ—Å–∞</span></div>
                <div class="grid-item" onclick="nav('rewards')"><div class="icon-box" style="color: #FF9500;"><i class="fa-solid fa-users"></i></div><span class="grid-lbl">–†–µ—Ñ–µ—Ä–∞–ª—ã</span></div>
                
                <div class="grid-item" onclick="nav('prohibited')"><div class="icon-box" style="color: #FF3B30;"><i class="fa-solid fa-hand"></i></div><span class="grid-lbl">–ó–∞–ø—Ä–µ—â–µ–Ω–æ</span></div>
                <div class="grid-item" onclick="nav('rates')"><div class="icon-box" style="color: #007AFF;"><i class="fa-solid fa-tags"></i></div><span class="grid-lbl">–¢–∞—Ä–∏—Ñ—ã</span></div>
                <div class="grid-item" onclick="tg.openLink('https://t.me/your_support')"><div class="icon-box" style="color: #5856D6;"><i class="fa-solid fa-comment-dots"></i></div><span class="grid-lbl">–ü–æ–º–æ—â—å</span></div>
                
                <div class="grid-item" onclick="nav('about')"><div class="icon-box"><i class="fa-solid fa-building"></i></div><span class="grid-lbl">–û –Ω–∞—Å</span></div>
                <div class="grid-item" onclick="tg.showAlert('–ß–∏—Ç–∞–π—Ç–µ –æ—Ç–∑—ã–≤—ã –≤ –Ω–∞—à–µ–º –∫–∞–Ω–∞–ª–µ!')"><div class="icon-box" style="color: #FFD60A;"><i class="fa-solid fa-star-half-stroke"></i></div><span class="grid-lbl">–û—Ç–∑—ã–≤—ã</span></div>
            </div>
        </div>
    </div>

    <div id="screen-prohibited" class="screen">
        <div class="nav-head"><div onclick="nav('china')"><i class="fa-solid fa-arrow-left"></i></div><div class="pg-title">–ó–∞–ø—Ä–µ—â–µ–Ω–æ –∫ –≤–≤–æ–∑—É</div></div>
        <div class="container">
            <div class="card" style="border-left: 4px solid #FF3B30; background: #FFF5F5;">
                <b style="color:#FF3B30; font-size: 16px;">‚ö†Ô∏è –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</b><br>
                <small>–î–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å—Ç—Ä–æ–≥–æ –∑–∞–ø—Ä–µ—â–µ–Ω—ã –∫ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–π –ø–µ—Ä–µ–≤–æ–∑–∫–µ:</small>
            </div>
            <div class="card">
                <h4 style="margin: 0 0 10px 0; color: #E64646;"><i class="fa-solid fa-fire"></i> –û–ø–∞—Å–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞</h4>
                <p style="font-size: 13px; color: #666; margin: 0;">–ü–æ—Ä–æ—Ö, —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–∏, –ø–∞—Ç—Ä–æ–Ω—ã, –ª–µ–≥–∫–æ–≤–æ—Å–ø–ª–∞–º–µ–Ω—è—é—â–∏–µ—Å—è –º–µ—Ç–∞–ª–ª—ã (–º–∞–≥–Ω–∏–π, –Ω–∞—Ç—Ä–∏–π), —Ä–µ–∞–∫—Ç–∏–≤—ã.</p>
            </div>
            <div class="card">
                <h4 style="margin: 0 0 10px 0; color: #3A7DFF;"><i class="fa-solid fa-droplet"></i> –ñ–∏–¥–∫–æ—Å—Ç–∏ –∏ –≥–∞–∑—ã</h4>
                <p style="font-size: 13px; color: #666; margin: 0;">–ë–µ–Ω–∑–∏–Ω, —Ä–∞—Å—Ç–≤–æ—Ä–∏—Ç–µ–ª–∏, –ª–∞–∫–∏, –∫—Ä–∞—Å–∫–∏, –±–∞–ª–ª–æ–Ω—á–∏–∫–∏ –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º (—Å–ø—Ä–µ–∏), –≥–∞–∑–æ–≤—ã–µ –±–∞–ª–ª–æ–Ω—ã.</p>
            </div>
            <div class="card">
                <h4 style="margin: 0 0 10px 0; color: #1F1F1F;"><i class="fa-solid fa-gun"></i> –û—Ä—É–∂–∏–µ</h4>
                <p style="font-size: 13px; color: #666; margin: 0;">–û–≥–Ω–µ—Å—Ç—Ä–µ–ª—å–Ω–æ–µ, –ø–Ω–µ–≤–º–∞—Ç–∏—á–µ—Å–∫–æ–µ, —Ç—Ä–∞–≤–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ä—É–∂–∏–µ, —ç–ª–µ–∫—Ç—Ä–æ—à–æ–∫–µ—Ä—ã, –¥—É–±–∏–Ω–∫–∏ –∏ –∑–∞–ø—á–∞—Å—Ç–∏ –∫ –Ω–∏–º.</p>
            </div>
            <div class="card">
                <h4 style="margin: 0 0 10px 0; color: #8E5AF7;"><i class="fa-solid fa-pills"></i> –ù–∞—Ä–∫–æ—Ç–∏—á–µ—Å–∫–∏–µ –≤–µ—â–µ—Å—Ç–≤–∞</h4>
                <p style="font-size: 13px; color: #666; margin: 0;">–ù–∞—Ä–∫–æ—Ç–∏–∫–∏, –ø—Ä–µ–∫—É—Ä—Å–æ—Ä—ã, —Å–∏–ª—å–Ω–æ–¥–µ–π—Å—Ç–≤—É—é—â–∏–µ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ã –±–µ–∑ —Ä–µ—Ü–µ–ø—Ç–∞, —Å—Ç–µ—Ä–æ–∏–¥—ã.</p>
            </div>
            <div class="card">
                <h4 style="margin: 0 0 10px 0; color: #FF9500;"><i class="fa-solid fa-battery-half"></i> –ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä—ã</h4>
                <p style="font-size: 13px; color: #666; margin: 0;">–õ–∏—Ç–∏–π-–∏–æ–Ω–Ω—ã–µ –±–∞—Ç–∞—Ä–µ–∏ –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤, Power Station. –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≤ —Ç–µ–ª–µ—Ñ–æ–Ω/–Ω–æ—É—Ç–±—É–∫ ‚Äî <b>—Ä–∞–∑—Ä–µ—à–µ–Ω—ã</b>.</p>
            </div>
            <div class="card">
                <h4 style="margin: 0 0 10px 0; color: #4CD964;"><i class="fa-solid fa-apple-whole"></i> –ü—Ä–æ—á–µ–µ</h4>
                <p style="font-size: 13px; color: #666; margin: 0;">–°–∫–æ—Ä–æ–ø–æ—Ä—Ç—è—â–∏–µ—Å—è –ø—Ä–æ–¥—É–∫—Ç—ã (–º—è—Å–æ, –æ–≤–æ—â–∏), –∂–∏–≤–æ—Ç–Ω—ã–µ, —Ä–∞—Å—Ç–µ–Ω–∏—è, —Å–µ–º–µ–Ω–∞, —à–ø–∏–æ–Ω—Å–∫–∞—è —Ç–µ—Ö–Ω–∏–∫–∞.</p>
            </div>
        </div>
    </div>

    <div id="screen-rates" class="screen">
        <div class="nav-head"><div onclick="nav('china')"><i class="fa-solid fa-arrow-left"></i></div><div class="pg-title">–ù–∞—à–∏ —Ç–∞—Ä–∏—Ñ—ã</div></div>
        <div class="container">
            <div class="card">
                <h3 style="margin:0 0 15px 0; color:var(--blue);">üì¶ –†–æ–∑–Ω–∏—á–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã</h3>
                <div class="rate-row" style="border-bottom: 1px solid #f2f2f2; padding: 10px 0;"><span>–î–æ 0.5 –∫–≥</span><b style="color:var(--text);">13 TJS <small>(—Ñ–∏–∫—Å)</small></b></div>
                <div class="rate-row" style="border-bottom: 1px solid #f2f2f2; padding: 10px 0;"><span>–æ—Ç 0.5 –¥–æ 1 –∫–≥</span><b style="color:var(--text);">23 TJS <small>(—Ñ–∏–∫—Å)</small></b></div>
                <div class="rate-row" style="border-bottom: 1px solid #f2f2f2; padding: 10px 0;"><span>–æ—Ç 1 –¥–æ 50 –∫–≥</span><b style="color:var(--text);">23 TJS / –∫–≥</b></div>
                <div class="rate-row" style="padding: 10px 0;"><span>–æ—Ç 50 –¥–æ 99 –∫–≥</span><b style="color:var(--green);">20 TJS / –∫–≥</b></div>
                <p style="font-size:12px; color:var(--sec); margin-top:10px; line-height: 1.4;">* –°—Ä–æ–∫ –∞–≤–∏–∞-–¥–æ—Å—Ç–∞–≤–∫–∏: 10-15 –¥–Ω–µ–π.<br>* –í–µ—Å –æ–∫—Ä—É–≥–ª—è–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º –∞–≤–∏–∞–ø–µ—Ä–µ–≤–æ–∑–æ–∫.</p>
            </div>
            <div class="card" style="background: #F8F9FB;">
                <h3 style="margin:0 0 12px 0;">üè¢ –û–ø—Ç–æ–≤—ã–µ —Ç–∞—Ä–∏—Ñ—ã</h3>
                <div class="rate-row"><span>–•–æ–∑—Ç–æ–≤–∞—Ä—ã</span> <b>–æ—Ç $0.55 / –∫–≥</b></div>
                <div class="rate-row"><span>–û–¥–µ–∂–¥–∞ / –û–±—É–≤—å</span> <b>–æ—Ç $0.75 / –∫–≥</b></div>
                <button class="btn btn-blue" style="margin-top: 15px;" onclick="nav('calc')">–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ</button>
            </div>
        </div>
    </div>

    <div id="screen-about" class="screen">
        <div class="nav-head"><div onclick="nav('china')"><i class="fa-solid fa-arrow-left"></i></div><div class="pg-title">–û –Ω–∞—Å</div></div>
        <div class="container">
            <div class="card" style="text-align:center;">
                <div style="font-size:40px;margin-bottom:10px;">üöÄ</div>
                <h2 style="margin:0;">Drop Logistics</h2>
                <p style="color:var(--sec);font-size:14px;">–í–∞—à–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ –∏–∑ –ö–∏—Ç–∞—è</p>
            </div>
            <div class="card">
                <p style="margin-top:0;">–ú—ã ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –Ω–∞–¥–µ–∂–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É –≥—Ä—É–∑–æ–≤ –∏–∑ –ö–∏—Ç–∞—è –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω.</p>
                <p>‚úÖ <b>–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∫–ª–∞–¥—ã</b> –≤ –ò—É –∏ –£—Ä—É–º—á–∏.</p>
                <p>‚úÖ <b>–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã</b> –∏ —á–µ—Å—Ç–Ω—ã–π –≤–µ—Å.</p>
                <p>‚úÖ <b>–ë—ã—Å—Ç—Ä–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</b> –≤ Telegram.</p>
            </div>
        </div>
    </div>

    <div id="screen-packages" class="screen">
        <div class="nav-head"><div onclick="nav('china')"><i class="fa-solid fa-arrow-left"></i></div><div class="pg-title">–ú–æ–∏ –ø–æ—Å—ã–ª–∫–∏</div></div>
        <div class="container">
            <button class="btn btn-blue" onclick="openM('m-add')" style="margin-bottom:15px;"><i class="fa-solid fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫</button>
            <div class="card" id="full-pkg-list"></div>
        </div>
    </div>

    <div id="screen-addresses" class="screen">
        <div class="nav-head"><div onclick="nav('china')"><i class="fa-solid fa-arrow-left"></i></div><div class="pg-title">–ù–∞—à–∏ –∞–¥—Ä–µ—Å–∞</div></div>
        <div class="container">
            <div class="card">
                <div class="switch-row"><b>–û–ø—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (>100 –∫–≥)</b><label class="switch"><input type="checkbox" id="tg-opt" onchange="toggleMode()"><span class="slider"></span></label></div>
            </div>
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <b>–ê–¥—Ä–µ—Å –≤ –ö–∏—Ç–∞–µ</b>
                    <select id="sel-city" onchange="renderAddr()" style="width: auto; height: 30px; font-size: 12px; display:none; padding: 0 5px; margin: 0;">
                        <option value="yiwu">–ò—É (Yiwu)</option><option value="urumqi">–£—Ä—É–º—á–∏</option>
                    </select>
                </div>
                <div class="copy-box" onclick="copy('txt-addr')">
                    <div id="txt-addr" class="copy-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <i class="fa-regular fa-copy" style="position:absolute; right:12px; top:15px; color:var(--blue);"></i>
                </div>
            </div>
            <div class="card" id="box-code">
                <b>–ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û):</b>
                <div class="copy-box" onclick="copy('txt-code')" style="background: #FFF9C4; margin-top:10px; border-color: #FBC02D;">
                    <div id="txt-code" class="copy-text" style="font-weight:900; color:#F57F17;">...</div>
                    <i class="fa-regular fa-copy" style="position:absolute; right:12px; top:15px; color:#F57F17;"></i>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-calc" class="screen">
        <div class="nav-head"><div onclick="goHome()"><i class="fa-solid fa-arrow-left"></i></div><div class="pg-title">–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏</div></div>
        <div class="container">
            <div class="card">
                <div class="switch-row" style="margin-bottom:15px;"><b>–û–ø—Ç–æ–≤—ã–π —Ç–∞—Ä–∏—Ñ</b><label class="switch"><input type="checkbox" id="tg-calc" onchange="toggleMode()"><span class="slider"></span></label></div>
                <div id="box-calc-opt" style="display:none; border-top:1px solid #eee; padding-top:10px;">
                    <select id="sel-route"></select>
                    <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px;">
                        <input id="c-len" type="number" placeholder="–î–ª–∏–Ω–∞">
                        <input id="c-wid" type="number" placeholder="–®–∏—Ä–∏–Ω–∞">
                        <input id="c-hei" type="number" placeholder="–í—ã—Å–æ—Ç–∞">
                    </div>
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                    <input id="c-wg" type="number" placeholder="–í–µ—Å (–∫–≥)">
                    <input id="c-qty" type="number" value="1" placeholder="–ö–æ–ª-–≤–æ">
                </div>
                <div id="c-res-wrap" style="background:#f8f9fa; border-radius:14px; padding:20px; margin:20px 0; text-align:center;">
                    <div id="c-res" style="font-size:36px; font-weight:800; color:var(--blue);">0.00</div>
                    <div id="c-cur" style="font-size:14px; color:var(--sec);">–ö –æ–ø–ª–∞—Ç–µ</div>
                </div>
                <button class="btn btn-blue" onclick="doCalc()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                <button id="btn-order-confirm" class="btn" onclick="submitOrder()" style="display:none; background:#34C759; margin-top:10px;">–û—Ñ–æ—Ä–º–∏—Ç—å –≥—Ä—É–∑</button>
            </div>
        </div>
    </div>

    <div id="screen-settings" class="screen"><div class="nav-head"><div onclick="goHome()"><i class="fa-solid fa-arrow-left"></i></div><div class="pg-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div></div><div class="container"><div class="card"><input id="s-name" placeholder="–í–∞—à–µ –∏–º—è"><input id="s-phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω"><select id="s-pvz"></select><button class="btn btn-blue" onclick="saveSet()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></div></div></div>
    <div id="screen-trucks" class="screen"><div class="nav-head"><div onclick="goHome()"><i class="fa-solid fa-arrow-left"></i></div><div class="pg-title">–ë–∏—Ä–∂–∞</div></div><div class="container"><div class="tabs"><div class="tab active" onclick="swTr('trips', this)">–ú–∞—à–∏–Ω—ã</div><div class="tab" onclick="swTr('cargo', this)">–ì—Ä—É–∑—ã</div></div><div id="list-trucks"></div></div></div>
    <div id="screen-market" class="screen"><div class="nav-head"><div onclick="goHome()"><i class="fa-solid fa-arrow-left"></i></div><div class="pg-title">–ú–∞—Ä–∫–µ—Ç</div></div><div class="container"><div class="tabs"><div class="tab active" onclick="swMk('item', this)">–¢–æ–≤–∞—Ä—ã</div><div class="tab" onclick="swMk('joint', this)">–°–±–æ—Ä—ã</div></div><div id="list-market"></div></div></div>
    <div id="screen-rewards" class="screen"><div class="nav-head"><div onclick="goHome()"><i class="fa-solid fa-arrow-left"></i></div><div class="pg-title">–ó–∞–¥–∞–Ω–∏—è</div></div><div class="container"><div id="list-rewards"></div></div></div>

    <div id="m-add" class="modal-wrap"><div class="modal"><h3>–ù–æ–≤—ã–π —Ç—Ä–µ–∫</h3><input id="n-t" placeholder="–¢—Ä–µ–∫-–Ω–æ–º–µ—Ä"><input id="n-d" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"><button class="btn btn-blue" onclick="subTrack()">–î–æ–±–∞–≤–∏—Ç—å</button><div style="text-align:center;padding:15px;color:var(--sec);" onclick="closeM('m-add')">–û—Ç–º–µ–Ω–∞</div></div></div>

    <script>
        const tg = window.Telegram.WebApp;
        const API = "https://unforeshortened-interartistic-judith.ngrok-free.dev"; 
        const uid = tg.initDataUnsafe?.user?.id || 317295540;
        let config = {}, user = {}, isOpt = false, lastCalc = null, tabTr = 'trips', tabMk = 'item';

        async function init() {
            try {
                // –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ–º —Ñ–æ—Ç–æ –∏–∑ –¢–ì
                const photo = tg.initDataUnsafe?.user?.photo_url;
                const firstName = tg.initDataUnsafe?.user?.first_name || "Client";
                const placeholder = `https://ui-avatars.com/api/?name=${encodeURIComponent(firstName)}&background=007AFF&color=fff`;
                
                gid('u-ava').src = photo || placeholder;
                gid('p-ava').src = photo || placeholder;

                let r = await fetch(`${API}/api/dashboard/${uid}`, { 
                    headers: { 'ngrok-skip-browser-warning': 'true' }
                });
                let d = await r.json();
                config = d.app_config; user = d.user_info;
                
                // –ì–ª–∞–≤–Ω–∞—è
                gid('u-name').innerText = user.name || firstName;
                gid('u-id').innerText = user.user_id; gid('u-lvl').innerText = user.level || "–ù–æ–≤–∏—á–æ–∫";
                gid('u-bonus').innerText = user.bonus_kg || 0; gid('txt-code').innerText = user.marking_code;
                
                // –ü—Ä–æ—Ñ–∏–ª—å
                gid('p-name').innerText = user.name || firstName;
                gid('p-id').innerText = user.user_id;
                gid('p-bonus').innerText = user.bonus_kg || 0;
                gid('p-lvl-tag').innerText = user.level || "–ù–æ–≤–∏—á–æ–∫";
                gid('p-status-name').innerText = user.level || "–ù–æ–≤–∏—á–æ–∫";

                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                gid('s-name').value = user.name || ""; gid('s-phone').value = user.phone || "";
                
                renderPvzOptions(config.pvz_list, user.pvz_id);
                renderPackageList(d.packages);
                if (config.routes) renderRoutes(config.routes);

                isOpt = (user.category === 'more_100');
                updMode();
            } catch(e) { console.error(e); }
        }

        function renderRoutes(routes) {
            const sel = gid('sel-route');
            if (!sel || !routes) return;
            sel.innerHTML = '';
            routes.forEach(r => {
                let opt = document.createElement('option');
                opt.value = r; opt.innerText = r;
                sel.appendChild(opt);
            });
        }

        function renderPackageList(pkgs) {
            let h = '';
            if (pkgs && pkgs.length > 0) {
                pkgs.forEach(p => {
                    let stClass = p.status_text.includes('–ü—Ä–∏–±—ã–ª') ? 'status-ready' : '';
                    h += `<div class="pkg-item"><div class="pkg-info"><div class="pkg-name">${p.description || '–ü–æ—Å—ã–ª–∫–∞'}</div><div class="pkg-sub">${p.track_number}</div></div><div class="pkg-status ${stClass}">${p.status_text}</div></div>`;
                });
            } else { h = '<div style="text-align:center;padding:20px;color:#8e8e93;">–ü–æ—Å—ã–ª–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</div>'; }
            gid('full-pkg-list').innerHTML = h;
        }

        function renderPvzOptions(list, currentId) {
            let sel = gid('s-pvz'); sel.innerHTML = '<option value="">–ù–µ –≤—ã–±—Ä–∞–Ω</option>';
            if (list) list.forEach(p => {
                let opt = document.createElement('option'); opt.value = p.id; opt.innerText = p.name;
                if (p.id == currentId) opt.selected = true;
                sel.appendChild(opt);
            });
        }

        function nav(id) {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            gid('screen-' + id).classList.add('active');
            if(id === 'trucks') ldTr();
            if(id === 'market') ldMk();
            if(id === 'rewards') ldRew();
            window.scrollTo(0,0);
        }

        function goHome() { nav('home'); }

        function toggleMode() {
            isOpt = gid('screen-calc').classList.contains('active') ? gid('tg-calc').checked : gid('tg-opt').checked;
            updMode();
            fetch(`${API}/api/update_settings`, {
                method: 'POST', headers: {'Content-Type':'application/json'},
                body: JSON.stringify({user_id:uid, category: isOpt ? 'more_100' : 'less_100'})
            });
        }

        function updMode() {
            gid('tg-opt').checked = isOpt; gid('tg-calc').checked = isOpt;
            gid('sel-city').style.display = isOpt ? 'block' : 'none';
            gid('box-code').style.display = isOpt ? 'none' : 'block';
            gid('box-calc-opt').style.display = isOpt ? 'block' : 'none';
            renderAddr();
        }

        function renderAddr() {
            if(!config.warehouses) return;
            if (isOpt) gid('txt-addr').innerText = config.warehouses?.wholesale?.[gid('sel-city').value]?.address || "–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥";
            else gid('txt-addr').innerText = config.warehouses?.retail?.address || "–ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω";
        }

        async function ldTr() {
            let c = gid('list-trucks'); c.innerHTML = '<div style="text-align:center;padding:20px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            try {
                let r = await fetch(`${API}/api/trucking/list?type=${tabTr}`, { headers: { 'ngrok-skip-browser-warning': 'true' }});
                let d = await r.json(); c.innerHTML = '';
                if(!d.items || d.items.length === 0) { c.innerHTML = '<div style="text-align:center;padding:40px;color:#8e8e93;">–û–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</div>'; return; }
                d.items.forEach(i => { 
                    c.innerHTML += `<div class="card"><div style="font-weight:700;font-size:16px;">${i.title}</div><div style="font-size:13px;color:#8e8e93;margin:4px 0;">${i.subtitle}</div><div style="color:var(--blue); font-weight:800; font-size:15px; margin-top:8px;">${i.details}</div></div>`; 
                });
            } catch(e) { c.innerHTML = '<div style="text-align:center;padding:20px;color:red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>'; }
        }

        async function ldMk() {
            let c = gid('list-market'); c.innerHTML = '<div style="text-align:center;padding:20px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            try {
                let r = await fetch(`${API}/api/market/list?type=${tabMk}`, { headers: { 'ngrok-skip-browser-warning': 'true' }});
                let d = await r.json(); c.innerHTML = '';
                if(!d.items || d.items.length === 0) { c.innerHTML = '<div style="text-align:center;padding:40px;color:#8e8e93;">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>'; return; }
                let h = '<div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">';
                d.items.forEach(i => { 
                    h += `<div class="card" style="padding:10px;margin-bottom:0;"><img src="${i.img}" style="width:100%; height:120px; object-fit:cover; border-radius:12px; margin-bottom:8px;" onerror="this.src='https://via.placeholder.com/150'"><div style="font-weight:600; font-size:13px; height:32px; overflow:hidden; line-height:1.2;">${i.title}</div><div style="color:var(--blue); font-weight:800; margin-top:6px;">${i.price}</div></div>`; 
                });
                c.innerHTML = h + '</div>';
            } catch(e) { c.innerHTML = '<div style="text-align:center;padding:20px;color:red;">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</div>'; }
        }

        async function ldRew() {
            let c = gid('list-rewards'); c.innerHTML = '<div style="text-align:center;padding:20px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            try {
                let r = await fetch(`${API}/api/rewards/list/${uid}`, { headers: { 'ngrok-skip-browser-warning': 'true' }});
                let d = await r.json(); c.innerHTML = '';
                if(!d.tasks || d.tasks.length === 0) { c.innerHTML = '<div style="text-align:center;padding:40px;color:#8e8e93;">–ó–∞–¥–∞–Ω–∏–π –Ω–µ—Ç</div>'; return; }
                d.tasks.forEach(t => { c.innerHTML += `<div class="card" onclick="claimRew(${t.id})"><b>${t.title}</b><br><small>${t.desc}</small><div style="color:#F57F17; font-weight:800;">+${t.reward} –∫–≥</div></div>`; });
            } catch(e) { c.innerHTML = '<div style="text-align:center;padding:20px;color:red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>'; }
        }

        async function claimRew(id) {
            let r = await fetch(`${API}/api/rewards/claim`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({user_id:uid, task_id:id}) });
            let d = await r.json(); tg.showAlert(d.message || d.status); init();
        }

        function swTr(t, el) { tabTr = t; document.querySelectorAll('#screen-trucks .tab').forEach(x=>x.classList.remove('active')); el.classList.add('active'); ldTr(); }
        function swMk(t, el) { tabMk = t; document.querySelectorAll('#screen-market .tab').forEach(x=>x.classList.remove('active')); el.classList.add('active'); ldMk(); }

        async function doCalc() {
            let p = { user_id:uid, weight:parseFloat(gid('c-wg').value), quantity:parseInt(gid('c-qty').value), category:isOpt?'more_100':'less_100', length:parseFloat(gid('c-len').value)||0, width:parseFloat(gid('c-wid').value)||0, height:parseFloat(gid('c-hei').value)||0, route_from:isOpt?gid('sel-route').value.split(' - ')[0]:"üá®üá≥ –ö–∏—Ç–∞–π", route_to:isOpt?gid('sel-route').value.split(' - ')[1]:"üáπüáØ –•—É–¥–∂–∞–Ω–¥" };
            try {
                let r = await fetch(`${API}/api/calculate`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(p)});
                let j = await r.json();
                if(j.status==='ok'){ gid('c-res').innerText=j.price.toLocaleString(); gid('c-cur').innerText=j.currency; gid('btn-order-confirm').style.display='block'; lastCalc={...p, price:j.price, route:`${p.route_from} - ${p.route_to}`}; tg.HapticFeedback.impactOccurred('medium'); }
            } catch(e) { tg.showAlert("–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞"); }
        }

        async function submitOrder() {
            try {
                let r = await fetch(`${API}/api/create_order`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({user_id:uid, route:lastCalc.route, weight:lastCalc.weight*lastCalc.quantity, price:lastCalc.price}) });
                if((await r.json()).status==='ok') { tg.showAlert("–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!"); gid('btn-order-confirm').style.display='none'; }
            } catch(e) { tg.showAlert("–û—à–∏–±–∫–∞"); }
        }

        async function saveSet() {
            let d = {user_id:uid, full_name:gid('s-name').value, phone:gid('s-phone').value, pvz_id:parseInt(gid('s-pvz').value)};
            await fetch(`${API}/api/update_settings`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(d)});
            tg.showAlert("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã"); init(); goHome();
        }

        async function subTrack() {
            let d = {user_id:uid, track_number:gid('n-t').value, description:gid('n-d').value};
            await fetch(`${API}/api/add_track`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(d)});
            closeM('m-add'); init(); tg.showAlert("–¢—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω");
        }

        function gid(id) { return document.getElementById(id); }
        function openM(id) { gid(id).style.display = 'flex'; }
        function closeM(id) { gid(id).style.display = 'none'; }
        function copy(t) { navigator.clipboard.writeText(gid(t).innerText); tg.HapticFeedback.impactOccurred('light'); tg.showAlert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ"); }
        init();
    </script>
</body>
</html>
